
## Verbose of Vulnerability management process from scan to upload results to defectdojo

```sh
/# git clone https://gitlab.practical-devsecops.training/pdso/django.nv webapp
Cloning into 'webapp'...
warning: redirecting to https://gitlab.practical-devsecops.training/pdso/django.nv.git/
remote: Enumerating objects: 164, done.
remote: Total 164 (delta 0), reused 0 (delta 0), pack-reused 164
Receiving objects: 100% (164/164), 1.02 MiB | 31.57 MiB/s, done.
Resolving deltas: 100% (36/36), done.
/# cd webapp
/webapp# pip3 install bandit==1.7.1
Collecting bandit==1.7.1
  Downloading bandit-1.7.1-py3-none-any.whl (113 kB)
     |████████████████████████████████| 113 kB 20.6 MB/s 
Requirement already satisfied: PyYAML>=5.3.1 in /usr/local/lib/python3.9/dist-packages (from bandit==1.7.1) (6.0.2)
Collecting GitPython>=1.0.1
  Downloading GitPython-3.1.43-py3-none-any.whl (207 kB)
     |████████████████████████████████| 207 kB 65.2 MB/s 
Collecting stevedore>=1.20.0
  Downloading stevedore-5.3.0-py3-none-any.whl (49 kB)
     |████████████████████████████████| 49 kB 12.6 MB/s 
Collecting gitdb<5,>=4.0.1
  Downloading gitdb-4.0.11-py3-none-any.whl (62 kB)
     |████████████████████████████████| 62 kB 3.4 MB/s 
Collecting pbr>=2.0.0
  Downloading pbr-6.0.0-py2.py3-none-any.whl (107 kB)
     |████████████████████████████████| 107 kB 46.1 MB/s 
Collecting smmap<6,>=3.0.1
  Downloading smmap-5.0.1-py3-none-any.whl (24 kB)
Installing collected packages: smmap, gitdb, GitPython, pbr, stevedore, bandit
Successfully installed GitPython-3.1.43 bandit-1.7.1 gitdb-4.0.11 pbr-6.0.0 smmap-5.0.1 stevedore-5.3.0
/webapp# bandit -r . -f json | tee bandit-output.json
[main]  INFO    profile include tests: None
[main]  INFO    profile exclude tests: None
[main]  INFO    cli include tests: None
[main]  INFO    cli exclude tests: None
{
  "errors": [],
  "generated_at": "2024-08-23T05:36:19Z",
  "metrics": {
    "./manage.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 6,
      "nosec": 0
    },
    "./taskManager/__init__.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 0,
      "nosec": 0
    },
    "./taskManager/forms.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 56,
      "nosec": 0
    },
    "./taskManager/migrations/0001_initial.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 68,
      "nosec": 0
    },
    "./taskManager/migrations/0002_auto_20230304_1456.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 19,
      "nosec": 0
    },
    "./taskManager/migrations/__init__.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 0,
      "nosec": 0
    },
    "./taskManager/misc.py": {
      "CONFIDENCE.HIGH": 1.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 1.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 20,
      "nosec": 0
    },
    "./taskManager/models.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 70,
      "nosec": 0
    },
    "./taskManager/settings.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 3.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 3.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 67,
      "nosec": 0
    },
    "./taskManager/taskManager_urls.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 65,
      "nosec": 0
    },
    "./taskManager/tests.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 38,
      "nosec": 0
    },
    "./taskManager/urls.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 13,
      "nosec": 0
    },
    "./taskManager/views.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 1.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 1.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 556,
      "nosec": 0
    },
    "./taskManager/wsgi.py": {
      "CONFIDENCE.HIGH": 0.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 0.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 0.0,
      "SEVERITY.LOW": 0.0,
      "SEVERITY.MEDIUM": 0.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 10,
      "nosec": 0
    },
    "_totals": {
      "CONFIDENCE.HIGH": 1.0,
      "CONFIDENCE.LOW": 0.0,
      "CONFIDENCE.MEDIUM": 4.0,
      "CONFIDENCE.UNDEFINED": 0.0,
      "SEVERITY.HIGH": 1.0,
      "SEVERITY.LOW": 3.0,
      "SEVERITY.MEDIUM": 1.0,
      "SEVERITY.UNDEFINED": 0.0,
      "loc": 988,
      "nosec": 0
    }
  },
  "results": [
    {
      "code": "32     # Let's avoid the file corruption race condition!\n33     os.system(\n34         \"mv \" +\n35         uploaded_file.temporary_file_path() +\n36         \" \" +\n37         \"%s/%s\" %\n38         (upload_dir_path,\n39          title))\n40 \n",
      "col_offset": 4,
      "filename": "./taskManager/misc.py",
      "issue_confidence": "HIGH",
      "issue_severity": "HIGH",
      "issue_text": "Starting a process with a shell, possible injection detected, security issue.",
      "line_number": 33,
      "line_range": [
        33,
        34,
        35,
        36,
        37,
        38,
        39
      ],
      "more_info": "https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html",
      "test_id": "B605",
      "test_name": "start_process_with_a_shell"
    },
    {
      "code": "19 AWS_ACCESS_KEY_ID = 'AKIAYVP4CIPPERUVIFXG'\n20 AWS_SECRET_ACCESS_KEY = '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'\n21 \n22 SLACK_API_TOKEN = 'xoxp-4797898847-4799393255-4778181812-f140b6'\n",
      "col_offset": 24,
      "filename": "./taskManager/settings.py",
      "issue_confidence": "MEDIUM",
      "issue_severity": "LOW",
      "issue_text": "Possible hardcoded password: 'Zt2U1h267eViPnuSA+JO5ABhiu4T7XUMSZ+Y2Oth'",
      "line_number": 20,
      "line_range": [
        20,
        21
      ],
      "more_info": "https://bandit.readthedocs.io/en/latest/plugins/b105_hardcoded_password_string.html",
      "test_id": "B105",
      "test_name": "hardcoded_password_string"
    },
    {
      "code": "21 \n22 SLACK_API_TOKEN = 'xoxp-4797898847-4799393255-4778181812-f140b6'\n23 \n24 # Quick-start development settings - unsuitable for production\n25 # See https://docs.djangoproject.com/en/1.7/howto/deployment/checklist/\n26 \n27 # SECURITY WARNING: keep the secret key used in production secret!\n28 SECRET_KEY = '0yxzudryd8)-%)(fz&7q-!v&cq1u6vbfoc4u7@u_&i)b@4eh^q'\n",
      "col_offset": 18,
      "filename": "./taskManager/settings.py",
      "issue_confidence": "MEDIUM",
      "issue_severity": "LOW",
      "issue_text": "Possible hardcoded password: 'xoxp-4797898847-4799393255-4778181812-f140b6'",
      "line_number": 22,
      "line_range": [
        22,
        23,
        24,
        25,
        26,
        27
      ],
      "more_info": "https://bandit.readthedocs.io/en/latest/plugins/b105_hardcoded_password_string.html",
      "test_id": "B105",
      "test_name": "hardcoded_password_string"
    },
    {
      "code": "27 # SECURITY WARNING: keep the secret key used in production secret!\n28 SECRET_KEY = '0yxzudryd8)-%)(fz&7q-!v&cq1u6vbfoc4u7@u_&i)b@4eh^q'\n29 \n30 # A5: Security Misconfiguration\n31 # SECURITY WARNING: don't run with debug turned on in production!\n32 DEBUG = True\n",
      "col_offset": 13,
      "filename": "./taskManager/settings.py",
      "issue_confidence": "MEDIUM",
      "issue_severity": "LOW",
      "issue_text": "Possible hardcoded password: '0yxzudryd8)-%)(fz&7q-!v&cq1u6vbfoc4u7@u_&i)b@4eh^q'",
      "line_number": 28,
      "line_range": [
        28,
        29,
        30,
        31
      ],
      "more_info": "https://bandit.readthedocs.io/en/latest/plugins/b105_hardcoded_password_string.html",
      "test_id": "B105",
      "test_name": "hardcoded_password_string"
    },
    {
      "code": "175             curs.execute(\n176                 \"insert into taskManager_file ('name','path','project_id') values ('%s','%s',%s)\" %\n177                 (name, upload_path, project_id))\n178 \n",
      "col_offset": 16,
      "filename": "./taskManager/views.py",
      "issue_confidence": "MEDIUM",
      "issue_severity": "MEDIUM",
      "issue_text": "Possible SQL injection vector through string-based query construction.",
      "line_number": 176,
      "line_range": [
        176,
        177
      ],
      "more_info": "https://bandit.readthedocs.io/en/latest/plugins/b608_hardcoded_sql_expressions.html",
      "test_id": "B608",
      "test_name": "hardcoded_sql_expressions"
    }
  ]
}/webapp# curl https://gitlab.practical-devsecops.training/-/snippets/28/raw -o upload-results.py
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  3302  100  3302    0     0  38395      0 --:--:-- --:--:-- --:--:-- 38395
/webapp# export API_KEY=e016eaca224c3f43481ce0367aa42877844f3008
/webapp# python3 upload-results.py --host dojo-oiahxczk.lab.practical-devsecops.training --api_key $API_KEY --engagement_id 1 --product_id 1 --lead_id 1 --environment "Production" --result_file bandit-output.json --scanner "Bandit Scan"
{'Authorization': 'Token e016eaca224c3f43481ce0367aa42877844f3008'}
{'minimum_severity': 'Low', 'scan_date': '2024-08-23', 'verified': False, 'active': False, 'engagement': '1', 'lead': '1', 'scan_type': 'Bandit Scan', 'environment': 'Production'}
Successfully uploaded the results to Defect Dojo
/webapp# 
```

## Challenges 

### Scan the production machine https://prod-oiahxczk.lab.practical-devsecops.training with the help of the ZAP docker image softwaresecurityproject/zap-stable:2.14.0, and save the results to /webapp/zap-output.xml

```sh
docker run --user $(id -u):$(id -g) -w /zap -v $(pwd):/zap/wrk:rw \
           --rm softwaresecurityproject/zap-stable:2.14.0 zap-baseline.py \
           -t https://prod-oiahxczk.lab.practical-devsecops.training \
           -d -x zap-output.xml
```

### Upload the ZAP scan results to Defect Dojo

```sh
python3 upload-results.py --host dojo-oiahxczk.lab.practical-devsecops.training \
    --api_key $API_KEY --engagement_id 1 --product_id 1 \
    --lead_id 1 --environment "Production" \
    --result_file /webapp/zap-output.xml \
    --scanner "ZAP Scan"
```